<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-2024/system-design-interview" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">《搞定系统设计：面试敲开大厂的门》 | Lucas Blog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://xbpk3t.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://xbpk3t.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://xbpk3t.github.io/2024/system-design-interview"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="《搞定系统设计：面试敲开大厂的门》 | Lucas Blog"><meta data-rh="true" name="description" content="概览"><meta data-rh="true" property="og:description" content="概览"><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://xbpk3t.github.io/2024/system-design-interview"><link data-rh="true" rel="alternate" href="https://xbpk3t.github.io/zh-Hans/2024/system-design-interview" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://xbpk3t.github.io/2024/system-design-interview" hreflang="en"><link data-rh="true" rel="alternate" href="https://xbpk3t.github.io/2024/system-design-interview" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://RV6E9N0CVW-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-G0687BFERF"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-G0687BFERF",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Lucas Blog" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.861a3018.css">
<script src="/assets/js/runtime~main.a99972dc.js" defer="defer"></script>
<script src="/assets/js/main.acc1978c.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Hacking" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Hacking" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Hacking</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Archive</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">2024</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/archive-logs">【存档】log-xxx</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/geektime-lessons">速读几本极客时间课程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/reading-methods">《聪明的阅读者》读书笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/monthly9">Monthly#9</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/mysql-lessons">《MySQL 45讲》读书笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/goreleaser">用 goreleaser 代替 changelogithub</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/tech-team-managing">《技术管理实战 36 讲》读书笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/flomo-bulk-delete">flomo批量删除脚本</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/deprecated-commands">【存档】备份一些repo命令</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/alfred-vs">alfred-vs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024">s</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/running">running</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/Design-Pattern">设计模式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/code-spec">代码规范</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/php">php相关存档</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/regex">regex</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/ssh-protocol">ssh协议</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/tcpdump">tcpdump</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/xq">相亲</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/zhihu">知乎文章摘录</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/buy-byd-seal-06gt">【海豹06GT】购车记录</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/feed-manage-2">信息源管理2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/monthly8">Monthly#8</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/sun-zi">《孙子兵法》读书笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/2024/system-design-interview">《搞定系统设计：面试敲开大厂的门》</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/how-to-write-commentary">《时评写作十讲》读书笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/how-to-write-book-review">怎么写书评？</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/zai-zhi-tian-xia">《宰执天下》书评</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/wechat-read-app">微信读书APP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/golang-error">golang错误处理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/record-for-paris-olympics">巴黎奥运会纪录</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/sql">常用mysql sql整理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/pre-commit">为什么在CI中应该用pre-commit代替linters?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/argumentative-writing">议论文</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/feed-manage-1">信息源管理1（rss）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/shell-syntax">shell脚本常用语法</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/weekly13">Weekly#13</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/politics-of-legitimacy">《合法性的政治》读书笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2024/leng-jing">【Hac棱镜】文章合集</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">2023</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2023/weekly52">Weekly#52</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2023/weekly40">Weekly#40</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2023/kernel">《趣谈 Linux 操作系统》读书笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2023/network-protocol">network-protocol</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2023/secretary-work-handbook">《秘书工作手记》读书笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2023/capital-in-the-twenty-first-century">《21世纪资本论》读书笔记</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2023/ru-zi-di">《孺子帝》读后感</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2023/renamer-tool">文件批量重命名工具</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/2023/feng-hua-marathon">复盘奉化马拉松</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">2000</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/minimalist">极简生活</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/books">books.yml</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs">docs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/movies">movies.yml</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/music">music常识</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tv">tv.yml</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/x">x</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">2024</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">《搞定系统设计：面试敲开大厂的门》</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>《搞定系统设计：面试敲开大厂的门》</h1><div class="container_mg8B margin-vert--md"><time datetime="2024-8-30">August 30, 2024</time></div></header><div class="toolbar_VBrL"></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="概览">概览<a href="#概览" class="hash-link" aria-label="Direct link to 概览" title="Direct link to 概览">​</a></h2>
<p><a href="https://github.com/Admol/SystemDesign" target="_blank" rel="noopener noreferrer">Admol/SystemDesign: 系统设计面试：内幕指南（System Design Interview: An Insider’s Guide）</a></p>
<hr>
<p>这本书成书于2021年，还是比较新的，其中的系统设计题也确实是面试中比较高频的一些问题。</p>
<p>全书共17章</p>
<ul>
<li>第1章：</li>
<li>第2章：系统的容量估算</li>
<li>第3章：<em><strong>怎么回答系统设计类问题？</strong></em></li>
<li>从第4章到第7章：限流器、DHT、kvdb、分布式唯一id、</li>
<li>从第8章到第16章：短链模块、爬虫、通知模块、feed模块、聊天模块、搜索自动补全模块、视频分享模块、云盘、支付系统</li>
<li>第17章：</li>
</ul>
<p><em><strong>其中尤其需要注意的是第三章，贯穿了全书，后面的所有系统设计，都是按照这个思维框架进行分析的。</strong></em></p>
<p>其实这个东西不稀奇，甚至很简单，我也早就知道，但是一直没有实践过。直到看到这本书全都按照这个框架进行分析，才知道确实没做好。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="阅读笔记">阅读笔记<a href="#阅读笔记" class="hash-link" aria-label="Direct link to 阅读笔记" title="Direct link to 阅读笔记">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-怎么回答系统设计类问题">3: 怎么回答系统设计类问题？<a href="#3-怎么回答系统设计类问题" class="hash-link" aria-label="Direct link to 3: 怎么回答系统设计类问题？" title="Direct link to 3: 怎么回答系统设计类问题？">​</a></h3>
<p><a href="https://cloud.tencent.com/developer/article/1745238" target="_blank" rel="noopener noreferrer">系统设计面试题指北-腾讯云开发者社区-腾讯云</a> 这个post和  本书里的流程一模一样</p>
<p>一共四步</p>
<p><em><strong>确定需求（具体功能、功能细节、QPS）、抽象设计（画简易架构图，具体来说就是确定架构的各组件）、常见优化点、结合该系统对优化进行实现</strong></em></p>
<p><em><strong>上面这个流程说起来简单，但是做起来需要很扎实的基础</strong></em>（这可能也是为啥我一直实践不了这个流程的原因吧）</p>
<p>这里抛开不同系统的具体需求，只说通用需求</p>
<p>比如说 <em><strong>确定需求就需要封底估算，就需要知道常见性能指标，还要搞清楚这些性能指标通常对应着什么运营指标（也就是要知道性能指标和运营指标之间的换算）</strong></em></p>
<p>抽象设计，就需要了解各种组件，以及这些组件的性能指标</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>常用组件的性能指标</summary><div><div class="collapsibleContent_i85q"><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">然后我们需要了解一些常见的性能指标，这是我们需要记在脑子里的：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Nginx：能轻松的处理c100k问题，内存越大，能处理的并发量越高</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Redis: https://redis.io/topics/benchmarks 表明，对于GET/SET来说，QPS 10-100k没啥大问题</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MySQL: https://www.mysql.com/why-mysql/benchmarks/ 表明，对于只读，QPS 几百k没啥问题，对于写，MySQL 5.7 QPS 100k 几乎是上限</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PG: https://www.percona.com/blog/2017/01/06/millions-queries-per-second-postgresql-and-mysql-peaceful-battle-at-modern-demanding-workloads/ 也是差不多</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">这些数据是不准确的，因为：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">和怎么用关系很大</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">和硬件配置关系很大</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">但是我们心里还是要有个大概印象。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<p>系统常见优化点则是通用的</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>系统常见优化点</summary><div><div class="collapsibleContent_i85q"><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Step3:考虑系统目前需要优化的点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">对系统进行抽象设计之后，你需要思考当前抽象的系统设计有哪些需要优化的点，比如说：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">当前系统部署在一台机器够吗？是否需要部署在多台机器然后进行负载均衡呢？</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">数据库处理速度能否支撑业务需求？是否需要给指定字段加索引？是否需要读写分离？是否需要缓存？</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">数据量是否大到需要分库分表？</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">是否存在安全隐患？</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">系统是否需要分布式文件系统？</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-限流器">4: 限流器<a href="#4-限流器" class="hash-link" aria-label="Direct link to 4: 限流器" title="Direct link to 4: 限流器">​</a></h3>
<p>这章分为两部分，功能和架构上实现限流</p>
<p>功能上，其实书中搞错了，这几种bucket算法都无法解决临界区的突发流量问题，也就是说如果限制 300reqs/sec, 那么在1s到2s中间其实可以发送600个req，<em><strong>正确的做法应该是用redis lua实现，并且还天然支持分布式系统</strong></em></p>
<ul>
<li><a href="https://stripe.com/blog/rate-limiters" target="_blank" rel="noopener noreferrer">Scaling your API with rate limiters</a></li>
<li><a href="https://gist.github.com/ptarjan/e38f45f2dfe601419ca3af937fff574d" target="_blank" rel="noopener noreferrer">0-rate-limiters.md</a></li>
</ul>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">在设置好限流器之后，收集数据来检查限流器是否有效是很重要的。我们主要想确保：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">•流量限制算法有效。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">•流量限制  规则有效。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">举个例子，如果流量限制规则太严格，就会导致很多有效请求被丢弃。在这种情况下，我们希望稍微放宽限制。另一个例子是，我们发现，在限时促销这种流量激增的场景下，限流器变得无效了。因此，可能需要换一种流量限制算法来应对突发的流量。这时候，代币桶就是一个合适的替代算法。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>架构上，书中抛出了一个问题，<em><strong>在分布式系统中怎么使用限流器？</strong></em></p>
<p>很简单，hystrix 之类的circuit breaker本身就支持限流器</p>
<p>那么，<em><strong>怎么实现一个简易的分布式系统的流量控制服务？</strong></em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="8-短链服务">8: 短链服务<a href="#8-短链服务" class="hash-link" aria-label="Direct link to 8: 短链服务" title="Direct link to 8: 短链服务">​</a></h3>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">写操作：每天生成1亿个URL。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">•每秒的写操作数：1亿÷24÷3600≈1160。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">•每秒的读操作数：假设读操作与写操作的比例是10∶1，那么每秒的读操作数是1160×10=11，600。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">•假设URL缩短器会运行10年，这意味着我们必须支持1亿×365×10=3650亿条记录。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">•假设URL的平均长度是100个字符，那么10年的存储容量需求是：3650亿×100字节≈36.5TB。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">与面试官一起审查这些假设和估算很重要，这样能确保你们俩对系统需求有相同的理解。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>需要注意保存时间，关系到存储成本</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="9-爬虫">9: 爬虫<a href="#9-爬虫" class="hash-link" aria-label="Direct link to 9: 爬虫" title="Direct link to 9: 爬虫">​</a></h3>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">下面的估算基于很多假设，与面试官交流并达成共识很重要。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">•假设每个月要下载10亿个网页。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">•QPS：1，000，000，000÷30÷24÷3600≈400，即每秒约400个网页。•峰值QPS=2×QPS=800。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">•假设平均每个网页的大小是500KB。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">•每月需要存储1，000，000，000×500KB=500TB。如果你不太熟悉存储单位的含义，请重新阅读第2章的2.1节。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">•假设数据要保存5年，则500TB×12×5=30PB，即需要30PB的存储空间来保存5年的内容。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">你可以把网络想成一个有向图，其中网页就是节点，超链接(URL)是边。爬虫在网络上爬行的过程可以看作是从一个网页到其他网页的有向图遍历。常见的两种图遍历算法是DFS和BFS。但是，因为DFS的深你可以把网络想成一个有向图，其中网页就是节点，超链接(URL)是边。爬虫在网络上爬行的过程可以看作是从一个网页到其他网页的有向图遍历。常见的两种图遍历算法是DFS和BFS。但是，因为DFS的深度  可能非常深，所以它通常不是一个好的选择。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BFS是爬虫常用的方法，通过先进先出(FIFO)队列来实现。在一个FIFO队列中，URL按照它们入列的顺序出列。尽管如此，这种实现方式还有以下两个问题。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">•同一个网页的大部分链接都指向同一个主机。如图9-5所示，wikipedia.com中的所有链接都是内部链接，这使得爬虫忙于处理来自同一个主机(wikipedia.com)的URL。当爬虫尝试并行下载网页时，维基百科的服务器会被大量请求“淹没”​。这样做被认为是“不礼貌”的。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">•标准的BFS并没有考虑URL的优先级。互联网很大，不是每个网页都有同样水平的质量和同等重要性。因此，我们可能想要基于网页的排名、网络流量、更新频率等对URL进行排序，以便优先处理某些网页。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">9.3.6 检测和避免有问题的内容本节讨论检测及避免重复、无意义或者有害内容的方法。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">蜘蛛陷阱</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">蜘蛛陷阱是可以导致爬虫陷入无限循环的网页，例如，一个无限深的目录结构www.spidertrapexample.com/foo/bar/foo/bar/foo/bar/…。可以通过设置最大URL长度来避免这样的蜘蛛陷阱。尽管如此，并不存在检测蜘蛛陷阱的通用解决方案。含有蜘蛛陷阱的网站是容易识别的，因为在这种网站上网页的数量异常多。但是很难开发出一个自动算法来躲避蜘蛛陷阱。不过，用户可以手动验证和识别蜘蛛陷阱，然后要么在爬取时排除这些网站，要么应用一些定制的URL过滤器。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>爬虫陷阱</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-im模块">12: IM模块<a href="#12-im模块" class="hash-link" aria-label="Direct link to 12: IM模块" title="Direct link to 12: IM模块">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-搜索建议模块">13: 搜索建议模块<a href="#13-搜索建议模块" class="hash-link" aria-label="Direct link to 13: 搜索建议模块" title="Direct link to 13: 搜索建议模块">​</a></h3>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">当我们在谷歌上搜索或者在亚马逊上购物时，只要在搜索框中打字，网页上就会展示一个或者更多的与搜索词匹配的结果。这个功能叫作自动补全(Autocomplete)、提前输入(Typeahead)、边输边搜(Search-as-you-type)或者增量搜索(Incremental Search)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">这引出了我们的面试问题：设计一个搜索自动补全系统，也即设计一个能展示“Top k查询词”或者“k个最常被搜索的查询词”的系统。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>搜索建议都是有时效性的</p>
<p>只不过不同应用的时敏不同而已，比如weibo, twitter, tiktok之类的社交媒体平台时敏就更高，也就是说时间权重更高</p>
<p>而google之类的搜索引擎则 search frequency的权重则高于 时效</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(1)如何扩展你的设计来支持多语言？</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">为了支持非英文的查询词，我们在字典树节点中存储Unicode字符。如果你不熟悉Unicode，这里介绍一下它的定义：​“一个涵盖世界上所有书写系统的所有字符的编码标准，无论是现代还是古代的书写系统。​”欲了解更多的内容，请访问Unicode的官网。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(2)如果某个国家的高频查询词与其他国家的不一样怎么办？</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">在这种情况下，我们可能要为不同国家构建不同的字典树。为了提升响应速度，我们可以把字典树存储在CDN中。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(3)如何支持趋势性（实时）查询词？</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">假设爆发了一个新闻事件，一个查询词瞬间变得流行起来。我们原先的设计并不能支持这种情况，这是因为：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">•原定每周更新字典树，所以下线的Worker并不会立即更新字典树。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">•即使正好是预定这个时间更新字典树，也需要花很长的时间来创建字典树。构建一个实时搜索自动补全系统是很复杂的，它不在本书的讨论范围内，这里我们只会提供一些思路：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">•通过分片来缩减工作数据集的大小。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">•改变排序模型，给最新的查询词分配更高的权重。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">•数据可能是以流的形式进入系统的，所以我们无法一次访问所有的数据。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">流数据意味着数据是持续生成的。流数据的处理需要一组不同的系统：Apache Hadoop MapReduce、Apache Spark Streaming、Apache Storm、Apache Kafka等。所有这些话题都涉及特定的领域知识，因此这里不会讨论它们的细节。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>峰值QPS为QPS×2</p>
<p><a href="https://www.google.com/search?q=%E5%B3%B0%E5%80%BCQPS%E4%B8%BAQPS%C3%972" target="_blank" rel="noopener noreferrer">峰值QPS为QPS×2 - Google Search</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="14-youtube">14: youtube<a href="#14-youtube" class="hash-link" aria-label="Direct link to 14: youtube" title="Direct link to 14: youtube">​</a></h3>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CDN成本。当由CDN来提供视频服务时，我们要为从CDN传输出去的数据付费。我们使用亚马逊的CDN CloudFront来进行成本估算，图14-1列出了数据传输到互联网的按需收费价格（每GB的价格，单位为美元）​。假设100%的流量都来自美国，平均每GB的价格是0.02美元。为了简单起见，我们只计算视频流服务的成本。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">500万×5个视频×0.3GB×0.02美元=150，000美元</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">根据这个粗略的成本估算，我们发现通过CDN来提供视频要花很多钱。即使云服务提供商愿意为大客户降低CDN成本，但这个费用还是很高。我们会在14.3节中谈论降低CDN成本的办法。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">之前已经讨论过，面试官建议使用已有的云服务而不是从头构建所有的东西。CDN和Blob存储是我们将会用到的云服务。有些读者可能会问，为什么不自己构建所有服务呢？原因如下：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">•系统设计面试不要求我们从头开始构建一切。在有限的面试时间里，选择正确的技术来正确地完成工作比详细解释技术的原理更重要。举个例子，对于面试来说，提到用Blob存储来存储源视频就足够了。要是谈论Blob存储的详细设计可能就有点画蛇添足了。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">•构建一个可扩展的Blob存储或者CDN是极其复杂和昂贵的。即使像Netflix或者Facebook这样的大公司也没有自己构建所有的东西。Netflix使用了亚马逊的云服务，Facebook使用Akamai的CDN。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>blob存储 其实就是类似 OSS, COS 之类的 object storage服务</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="15-云盘">15: 云盘<a href="#15-云盘" class="hash-link" aria-label="Direct link to 15: 云盘" title="Direct link to 15: 云盘">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="16-支付系统">16: 支付系统<a href="#16-支付系统" class="hash-link" aria-label="Direct link to 16: 支付系统" title="Direct link to 16: 支付系统">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="17-设计指标监控和告警系统">17: 设计指标监控和告警系统<a href="#17-设计指标监控和告警系统" class="hash-link" aria-label="Direct link to 17: 设计指标监控和告警系统" title="Direct link to 17: 设计指标监控和告警系统">​</a></h3>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>这本书的内容还是很实用的，对我来说有点浅了，但是查缺补漏嘛，还是学到了不少东西，比如：</p>
<ul>
<li>应该是 封底估算，而不是 容量估算</li>
</ul>
<p><a href="https://lijianfei.com/post/feng-di-gu-suan-back-of-the-envelope-estimation/#:~:text=Back%2Dof%2Dthe%2Denvelope%20estimation%EF%BC%8C%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91%E4%B8%BA,%E4%BC%B0%E8%AE%A1%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98%E7%9A%84%E8%A7%A3%E3%80%82" target="_blank" rel="noopener noreferrer">封底估算(Back-of-the-Envelope Estimation) | lijianfei.com</a></p>
<p>back of the envelop estimation =</p>
<p>封底估算 通常涉及哪些方面？</p>
<p><em><strong>通常是先确定需求，计算QPS，再根据读写比，得出读写操作各自的QPS。再假设该服务运行时间，计算存储成本。</strong></em></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="20231113-短链接">[2023/11/13] 短链接<a href="#20231113-短链接" class="hash-link" aria-label="Direct link to [2023/11/13] 短链接" title="Direct link to [2023/11/13] 短链接">​</a></h2>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p><em>“短链接服务”的核心需求？有哪些发号器算法？</em></p><p>细节：映射关系？为什么要用 302 跳转？失效检测怎么做？</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="核心需求">核心需求<a href="#核心需求" class="hash-link" aria-label="Direct link to 核心需求" title="Direct link to 核心需求">​</a></h3>
<ul>
<li>短链接生成（发号器）</li>
<li>失效检测：自动遍历所有链接，判断是否已失效</li>
<li>关键词检测：设置关键词，用于判断网页内是否包 含此关键词，以判断是否失效</li>
<li>短链统计：转化排行榜（转化效果评估）</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="为什么要用短链而不是长链接">为什么要用短链，而不是长链接？<a href="#为什么要用短链而不是长链接" class="hash-link" aria-label="Direct link to 为什么要用短链，而不是长链接？" title="Direct link to 为什么要用短链，而不是长链接？">​</a></h3>
<ul>
<li>在限制内容长度的平台如短信、微博，可以有效控制</li>
<li>url 转二维码，最好使用短链，因为长链生成的二维码更密集，不利于传播</li>
<li>有些平台无法识别长链，只截取部分 url，会产生问题</li>
<li>可以统一管理所有 url，三方链接存在于多个网页/代码中，一旦变更，就需要多处更改</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="发号器">发号器<a href="#发号器" class="hash-link" aria-label="Direct link to 发号器" title="Direct link to 发号器">​</a></h3>
<p>短链接服务的<code>发号器</code>怎么实现？生成 url 的算法有哪些？怎么选择？</p>
<ul>
<li><code>类 uuid</code>（插入 db 时可能会频繁导致页分裂和不饱和的节点，导致数据库插入性能降低，影响插入性能）</li>
<li><code>snowflake</code>（snowflake 依赖于系统时钟的一致性，如果某台机器的系统时钟回拨，有可能造成 ID 冲突，或者 ID 乱序）</li>
<li><em><code>MurmurHash 算法</code>+<code>转进制</code></em>，MurmurHash 的 32bit 的最大值是 43 亿，10 进制转 62 进制之后，6 位数的 62 进制大概 568 亿</li>
<li><em>不希望反推出全局 ID，使用洗牌算法</em>，打乱算出的值，比如十进制的 201314 就可以转换为 Qn0。然后再使用洗牌算法，可以返回 n0Q、Q0n....其中之一。但是会有一定几率冲突，多洗几次就行</li>
<li>希望反推出全局 ID；那就在得到 Qn0 这个数字后，将其转换  为二进制数。然后在固定位，第五位，第十位...(等等) 插入一个随机值即可。至于如何反推也很简单，你拿到短链接 key 后，将固定位的数字去除，再转换为十进制即可。</li>
</ul>
<hr>
<ul>
<li>使用哈希算法，在短链接场景下，怎么避免哈希冲突呢？<!-- -->
<ul>
<li>根据布隆过滤器<em>如果返回不存在则一定不存在</em>的特性，进行反查，或者直接使用哈希冲突概率更低的<code>布谷鸟过滤器</code></li>
</ul>
</li>
<li>使用什么存储介质来保存短链？用 redis 存，往 db 里持久化一份就可以了，不要通过 db 去查询</li>
</ul>
<p><a href="https://stackoverflow.com/questions/22892120/how-to-generate-a-random-string-of-a-fixed-length-in-go" target="_blank" rel="noopener noreferrer">How to generate a random string of a fixed length in Go? - Stack Overflow</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="细节">细节<a href="#细节" class="hash-link" aria-label="Direct link to 细节" title="Direct link to 细节">​</a></h3>
<ul>
<li>短链接和长链接的映射关系？一对一还是一对多？为什么？</li>
<li>301 还是 302？为什么要用 302 跳转？</li>
<li>短链接的失效检测？</li>
</ul>
<hr>
<ul>
<li><em>一对多</em>，同一个长链接，因为不同的参数，所以生成不同的短链接</li>
<li>可以通过这些参数做数据分析，比如用户相关参数如<code>生成 url 的用户名</code>、<code>当前的 ua</code>、<code>之前的 referer</code>等参数</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="301-还是-302为什么要用-302-跳转">301 还是 302？为什么要用 302 跳转？<a href="#301-还是-302为什么要用-302-跳转" class="hash-link" aria-label="Direct link to 301 还是 302？为什么要用 302 跳转？" title="Direct link to 301 还是 302？为什么要用 302 跳转？">​</a></h3>
<p><em>一定要用 302 临时重定向，主要是基于<code>浏览器缓存问题</code>，以及由他产生的（坏链、统计和可控问题）三个问题</em></p>
<ul>
<li><code>坏链</code>，长链坏链了，我们修改之后，301 跳转还是会跳到坏链</li>
<li><code>短链可控问题</code>，如果部分长链的内容涉嫌违规，使用 301 跳转无法实现</li>
<li><code>统计问题</code>，使用 301 跳转，直接走缓存，服务端无法统计该 url 的真实使用次数</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="服务优化">服务优化<a href="#服务优化" class="hash-link" aria-label="Direct link to 服务优化" title="Direct link to 服务优化">​</a></h3>
<p>怎么优化短链接服务？</p>
<ul>
<li>分库分表</li>
<li>读写分离</li>
<li>引入缓存</li>
<li>可以修改<em>全局发号器</em>的算法</li>
<li>防攻击</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="抢红包">抢红包<a href="#抢红包" class="hash-link" aria-label="Direct link to 抢红包" title="Direct link to 抢红包">​</a></h2>
<p><strong>“抢红包”业务要注意哪些核心问题？技术难点？实现微信红包的具体流程？</strong> （设计一个抢红包的系统架构、如何保证每个人抢到，如何抗住流量？）</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">“抢红包”业务要注意哪些核心问题？技术难点？</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hr punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 拆包算法：红包里的金额怎么实现尽量均匀？</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 先拆后发，还是发时再拆？</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 存数据：红包应该用 redis 的哪种数据类型存？为什么？用 list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hr punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 红包分配算法这么设计的话，会不会出现两个手气最佳？如果出现金额相同的两个红包，先抢到的那个手气最佳</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 红包系统有哪些子系统？红包系统的核心系统可能有 </span><span class="token code-snippet code keyword" style="color:#00009f">`用户校验`</span><span class="token plain">(布隆过滤器)、</span><span class="token code-snippet code keyword" style="color:#00009f">`红包分发`</span><span class="token plain">、</span><span class="token code-snippet code keyword" style="color:#00009f">`异步持久化`</span><span class="token plain">、</span><span class="token code-snippet code keyword" style="color:#00009f">`系统降级`</span><span class="token plain">、</span><span class="token code-snippet code keyword" style="color:#00009f">`异步到账`</span><span class="token plain"> 这几个子系统</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">先拆后发，还是发时再拆？</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hr punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 每抢到一个红包，就 cas 剩余金额和红包个数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">红包只需要存红包总金额和分数，每个用户抢到的金额动态分配，抢到后记录该用户抢到的金额</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">需要解决高并发下“超卖”问题，每发一个红包，都相当于一次秒杀活动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hr punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">红包金额什么时候计算？拆的时候实时计算，还是预先生成？</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token italic punctuation" style="color:#393A34">*</span><span class="token italic content">是否 预先生成，要看具体业务，如果是微信红包这种流量相对均匀的业务，最好实时计算，这样不占内存空间，省成本。如果是春晚红包这种极端高并发业务，一定要预先分配，空间换时间，否则一定会被打挂</span><span class="token italic punctuation" style="color:#393A34">*</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">拆包算法：红包里的金额怎么实现尽量均匀？</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hr punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 随机，额度在 </span><span class="token code-snippet code keyword" style="color:#00009f">`0.01`</span><span class="token plain"> 到 </span><span class="token code-snippet code keyword" style="color:#00009f">`剩余平均值*2`</span><span class="token plain"> 之间（二倍均值）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 比如发 100 块钱，10 个红包，平均 10 块钱一个，发出来的红包的额度在 0.01-20 之间波动，当前面 3 个红包总共被领了 40 块钱时，剩下 60 块钱，总共 7 个红包，那么这 7 个红包的额度在：0.01～（60/7*2）=17.14 之间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">details</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token code-snippet code keyword" style="color:#00009f">`抢红包先后顺序`</span><span class="token plain">对</span><span class="token code-snippet code keyword" style="color:#00009f">`抢到最大金额`</span><span class="token plain">有影响吗？</span><span class="token code-snippet code keyword" style="color:#00009f">`抢红包人数`</span><span class="token plain">和</span><span class="token code-snippet code keyword" style="color:#00009f">`红包总金额`</span><span class="token plain"> 还有哪些参数对此实验会有影响？最好可视化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 100 块钱的红包，每组抢红包人数从 5 到 100 分为 5、10、20、50、100 共 5 组，每组都发 1000 次，redis 的 key 按照 </span><span class="token code-snippet code keyword" style="color:#00009f">`re:p:{xxx}:{seq}`</span><span class="token plain"> 设计，把每组数据进行拟合，纵轴手气最佳的概率，横轴抢红包人数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 总金额从 100 到 100w 按 5 个梯度，分为 5 组，抢红包人数均为 10 人，每组都发 1000 次，redis 的 key 按照 </span><span class="token code-snippet code keyword" style="color:#00009f">`re:money:{xxx}:{seq}`</span><span class="token plain"> 设计，把每组数据进行拟合，纵轴手气最佳概率，横轴红包总金额</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="在架构设计中一些快速估算的小技巧一些常见服务的经验值">在架构设计中一些快速估算的小技巧？一些常见服务的<code>经验值</code>？<a href="#在架构设计中一些快速估算的小技巧一些常见服务的经验值" class="hash-link" aria-label="Direct link to 在架构设计中一些快速估算的小技巧一些常见服务的经验值" title="Direct link to 在架构设计中一些快速估算的小技巧一些常见服务的经验值">​</a></h2>
<p><a href="https://www.raychase.net/6280" target="_blank" rel="noopener noreferrer">系统设计中的快速估算技巧 – 四火的唠叨</a></p>
<p>在架构设计中一些快速估算的小技巧？一些常见服务的<code>经验值</code>？</p>
<p>怎么在架构设计中进行容量设计？</p>
<ul>
<li>评估总访问量、平均 QPS、以及 QPS 极值</li>
<li>结合常见服务的<code>经验值</code>，估算预计各种服务需要的实例</li>
<li>做好压测很重要</li>
</ul>
<hr>
<p><em>需要知道一些常见服务的吞吐量、带宽、存储的经验值</em></p>
<p>单机吞吐量上限</p>
<ul>
<li>Web 服务器的 QPS：1000</li>
<li>RDB 单机 QPS：1000</li>
<li>NoSQL DB 磁盘单机 QPS：10K</li>
<li>内存访问单机 QPS：1M</li>
</ul>
<p>常见场景的耗时</p>
<ul>
<li>CPU 访问（包括 CPU 缓存）：10 纳秒</li>
<li>内存访问：100 纳秒</li>
<li>HDD 磁盘访问：10 毫秒，如果是 SSD 大约快 100 倍</li>
<li>HDD 磁盘吞吐量：100 MB/s，如果是 SSD 则高几倍</li>
<li>同机房网络时延：1 毫秒</li>
<li>异地网络时延：10 毫秒</li>
<li>国际网络时延：100 毫秒</li>
</ul>
<p>常用数据类型的占用字节 (在很多系统中，Boolean 占用 1 个字节，字符占用 2 个字节，Integer/Float 是 4 个字节，Long/Double 则是 8 个字节)</p>
<hr>
<ul>
<li>问清楚系统的具体要求（确定“核心功能”和“具体指标”）</li>
<li>对系统进行抽象设计（画架构图）</li>
<li>考虑系统目前需要优化的点，并针对这些问题提出解决方案（常见问题就是高可用和高并发的那些，还有分布式场景下的常见问题）</li>
</ul>
<p><a href="https://cloud.tencent.com/developer/article/1745238" target="_blank" rel="noopener noreferrer">系统设计面试题指北 - 云 + 社区 - 腾讯云</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-10-17T16:06:36.000Z" itemprop="dateModified">Oct 17, 2024</time></b> by <b>XBPk3T</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/2024/sun-zi"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">《孙子兵法》读书笔记</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/2024/how-to-write-commentary"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">《时评写作十讲》读书笔记</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#概览" class="table-of-contents__link toc-highlight">概览</a></li><li><a href="#阅读笔记" class="table-of-contents__link toc-highlight">阅读笔记</a><ul><li><a href="#3-怎么回答系统设计类问题" class="table-of-contents__link toc-highlight">3: 怎么回答系统设计类问题？</a></li><li><a href="#4-限流器" class="table-of-contents__link toc-highlight">4: 限流器</a></li><li><a href="#8-短链服务" class="table-of-contents__link toc-highlight">8: 短链服务</a></li><li><a href="#9-爬虫" class="table-of-contents__link toc-highlight">9: 爬虫</a></li><li><a href="#12-im模块" class="table-of-contents__link toc-highlight">12: IM模块</a></li><li><a href="#13-搜索建议模块" class="table-of-contents__link toc-highlight">13: 搜索建议模块</a></li><li><a href="#14-youtube" class="table-of-contents__link toc-highlight">14: youtube</a></li><li><a href="#15-云盘" class="table-of-contents__link toc-highlight">15: 云盘</a></li><li><a href="#16-支付系统" class="table-of-contents__link toc-highlight">16: 支付系统</a></li><li><a href="#17-设计指标监控和告警系统" class="table-of-contents__link toc-highlight">17: 设计指标监控和告警系统</a></li></ul></li><li><a href="#总结" class="table-of-contents__link toc-highlight">总结</a></li><li><a href="#20231113-短链接" class="table-of-contents__link toc-highlight">[2023/11/13] 短链接</a><ul><li><a href="#核心需求" class="table-of-contents__link toc-highlight">核心需求</a></li><li><a href="#为什么要用短链而不是长链接" class="table-of-contents__link toc-highlight">为什么要用短链，而不是长链接？</a></li><li><a href="#发号器" class="table-of-contents__link toc-highlight">发号器</a></li><li><a href="#细节" class="table-of-contents__link toc-highlight">细节</a></li><li><a href="#301-还是-302为什么要用-302-跳转" class="table-of-contents__link toc-highlight">301 还是 302？为什么要用 302 跳转？</a></li><li><a href="#服务优化" class="table-of-contents__link toc-highlight">服务优化</a></li></ul></li><li><a href="#抢红包" class="table-of-contents__link toc-highlight">抢红包</a></li><li><a href="#在架构设计中一些快速估算的小技巧一些常见服务的经验值" class="table-of-contents__link toc-highlight">在架构设计中一些快速估算的小技巧？一些常见服务的<code>经验值</code>？</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Docs. Built with Docusaurus. Hosted by Github & Cloudflare.</div></div></div></footer></div>
</body>
</html>